!function(a,b){typeof exports==='object'&&typeof module!=='undefined'?b(require('leaflet')):typeof define==='function'&&define.amd?define(['leaflet'],b):(b(a.L))}(this,(function(a){'use strict';a=a&&a.hasOwnProperty('default')?a['default']:a;L.Curve=L.Path.extend({options:{},initialize:function(a,b){L.setOptions(this,b);this._initialUpdate=!0;this._setPath(a)},getPath:function(){return this._coords},setPath:function(a){this._setPath(a);return this.redraw()},getBounds:function(){return this._bounds},_setPath:function(a){this._coords=a;this._bounds=this._computeBounds()},_computeBounds:function(){var a=new L.LatLngBounds(),b,c,d;for(var e=0;e<this._coords.length;e++){d=this._coords[e];if(typeof d=='string'||d instanceof String)c=d;else if(c=='H')a.extend([b.lat,d[0]]),b=new L.latLng(b.lat,d[0]);else if(c=='V')a.extend([d[0],b.lng]),b=new L.latLng(d[0],b.lng);else if(c=='C'){var f=new L.latLng(d[0],d[1]);d=this._coords[++e];var g=new L.latLng(d[0],d[1]);d=this._coords[++e];var h=new L.latLng(d[0],d[1]);a.extend(f);a.extend(g);a.extend(h);h.controlPoint1=f;h.controlPoint2=g;b=h}else if(c=='S'){g=new L.latLng(d[0],d[1]);d=this._coords[++e];h=new L.latLng(d[0],d[1]),f=b;if(b.controlPoint2){var i=b.lat-b.controlPoint2.lat,j=b.lng-b.controlPoint2.lng;f=new L.latLng(b.lat+i,b.lng+j)}a.extend(f);a.extend(g);a.extend(h);h.controlPoint1=f;h.controlPoint2=g;b=h}else if(c=='Q'){var k=new L.latLng(d[0],d[1]);d=this._coords[++e];h=new L.latLng(d[0],d[1]);a.extend(k);a.extend(h);h.controlPoint=k;b=h}else if(c=='T'){h=new L.latLng(d[0],d[1]),k=b;if(b.controlPoint){i=b.lat-b.controlPoint.lat,j=b.lng-b.controlPoint.lng;k=new L.latLng(b.lat+i,b.lng+j)}a.extend(k);a.extend(h);h.controlPoint=k;b=h}else a.extend(d),b=new L.latLng(d[0],d[1])}return a},getCenter:function(){return this._bounds.getCenter()},_update:function(){if(!this._map){return}this._updatePath()},_updatePath:function(){this._renderer._updatecurve(this)},_project:function(){var a,b,c,d;this._points=[];for(var e=0;e<this._coords.length;e++){a=this._coords[e];if(typeof a=='string'||a instanceof String)this._points.push(a),c=a;else{switch(a.length){case 2:d=this._map.latLngToLayerPoint(a);b=a;break;case 1:c=='H'?(d=this._map.latLngToLayerPoint([b[0],a[0]]),b=[b[0],a[0]]):(d=this._map.latLngToLayerPoint([a[0],b[1]]),b=[a[0],b[1]]);break};this._points.push(d)}}}});L.curve=function(a,b){return new L.Curve(a,b)};L.SVG.include({_updatecurve:function(a){this._setPath(a,this._curvePointsToPath(a._points));if(a.options.animate){var b=a._path,c=b.getTotalLength();a.options.dashArray||(b.style.strokeDasharray=c+' '+c);a._initialUpdate&&(b.animate([{strokeDashoffset:c},{strokeDashoffset:0}],a.options.animate),a._initialUpdate=!1)}},_curvePointsToPath:function(a){var b,c,d='';for(var e=0;e<a.length;e++){b=a[e];if(typeof b=='string'||b instanceof String)c=b,d+=c;else{switch(c){case 'H':d+=b.x+' ';break;case 'V':d+=b.y+' ';break;default:d+=b.x+','+b.y+' ';break}}}return d||'M0 0'}});function b(a,b,c,d){if(a===undefined)throw new Error('geometry is required');if(b&&b.constructor!==Object)throw new Error('properties must be an Object');var e={type:'Feature',properties:b||{},geometry:a};if(c){if(c.length!==4)throw new Error('bbox must be an Array of 4 numbers');e.bbox=c}d&&(e.id=d);return e}function c(a,b,c){if(!a)throw new Error('type is required');if(!b)throw new Error('coordinates is required');if(!Array.isArray(b))throw new Error('coordinates must be an Array');var g;switch(a){case 'Point':g=d(b).geometry;break;case 'LineString':g=f(b).geometry;break;case 'Polygon':g=e(b).geometry;break;case 'MultiPoint':g=i(b).geometry;break;case 'MultiLineString':g=h(b).geometry;break;case 'MultiPolygon':g=j(b).geometry;break;default:throw new Error(a+' is invalid')};if(c){if(c.length!==4)throw new Error('bbox must be an Array of 4 numbers');g.bbox=c}return g}function d(a,c,d,e){if(!a)throw new Error('No coordinates passed');if(a.length===undefined)throw new Error('Coordinates must be an array');if(a.length<2)throw new Error('Coordinates must be at least 2 numbers long');if(typeof a[0]!=='number'||typeof a[1]!=='number')throw new Error('Coordinates must contain numbers');return b({type:'Point',coordinates:a},c,d,e)}function e(a,c,d,e){if(!a)throw new Error('No coordinates passed');for(var f=0;f<a.length;f++){var g=a[f];if(g.length<4){throw new Error('Each LinearRing of a Polygon must have 4 or more Positions.')}for(var h=0;h<g[g.length-1].length;h++){if(g[g.length-1][h]!==g[0][h]){throw new Error('First and last Position are not equivalent.')}}}return b({type:'Polygon',coordinates:a},c,d,e)}function f(a,c,d,e){if(!a)throw new Error('No coordinates passed');if(a.length<2)throw new Error('Coordinates must be an array of two or more positions');return b({type:'LineString',coordinates:a},c,d,e)}function g(a,b){if(!a)throw new Error('No features passed');if(!Array.isArray(a))throw new Error('features must be an Array');var c={type:'FeatureCollection',features:a};b&&(c.bbox=b);return c}function h(a,c,d,e){if(!a)throw new Error('No coordinates passed');return b({type:'MultiLineString',coordinates:a},c,d,e)}function i(a,c,d,e){if(!a)throw new Error('No coordinates passed');return b({type:'MultiPoint',coordinates:a},c,d,e)}function j(a,c,d,e){if(!a)throw new Error('No coordinates passed');return b({type:'MultiPolygon',coordinates:a},c,d,e)}function k(a,c,d,e){if(!a)throw new Error('geometries is required');if(!Array.isArray(a))throw new Error('geometries must be an Array');return b({type:'GeometryCollection',geometries:a},c,d,e)}var l={miles:3960,nauticalmiles:3441.145,degrees:57.2957795,radians:1,inches:250905600,yards:6969600,meters:6373000,metres:6373000,centimeters:6.373e+8,centimetres:6.373e+8,kilometers:6373,kilometres:6373,feet:20908792.65},m={kilometers:0.000001,kilometres:0.000001,meters:1,metres:1,centimetres:10000,millimeter:1000000,acres:0.000247105,miles:3.86e-7,yards:1.195990046,feet:10.763910417,inches:1550.003100006};function n(a,b){if(a===undefined||a===null||isNaN(a))throw new Error('num is required');if(b&&!(b>=0))throw new Error('precision must be a positive number');var c=Math.pow(10,b||0);return Math.round(a*c)/c}function o(a,b){if(a===undefined||a===null)throw new Error('radians is required');var c=l[b||'kilometers'];if(!c)throw new Error('units is invalid');return a*c}function p(a,b){if(a===undefined||a===null)throw new Error('distance is required');var c=l[b||'kilometers'];if(!c)throw new Error('units is invalid');return a/c}function q(a,b){return s(p(a,b))}function r(a){if(a===null||a===undefined)throw new Error('bearing is required');var b=a%360;b<0&&(b+=360);return b}function s(a){if(a===null||a===undefined)throw new Error('radians is required');var b=a%(2*Math.PI);return b*180/Math.PI}function t(a){if(a===null||a===undefined)throw new Error('degrees is required');var b=a%360;return b*Math.PI/180}function u(a,b,c){if(a===null||a===undefined)throw new Error('distance is required');if(!(a>=0))throw new Error('distance must be a positive number');var d=o(p(a,b),c||'kilometers');return d}function v(a,b,c){if(a===null||a===undefined)throw new Error('area is required');if(!(a>=0))throw new Error('area must be a positive number');var d=m[b||'meters'];if(!d)throw new Error('invalid original units');var e=m[c||'kilometers'];if(!e)throw new Error('invalid final units');return a/d*e}var w={feature:b,geometry:c,featureCollection:g,geometryCollection:k,point:d,multiPoint:i,lineString:f,multiLineString:h,polygon:e,multiPolygon:j,radiansToDistance:o,distanceToRadians:p,distanceToDegrees:q,radians2degrees:s,degrees2radians:t,bearingToAngle:r,convertDistance:u,convertArea:v,round:n};function x(a,b,c){if(a===null)return;var d,e,f,g,h,i,j,k,l,m=0,n=0,o,p=a.type,q=p==='FeatureCollection',r=p==='Feature',s=q?a.features.length:1;for(d=0;d<s;d++){var t=0;l=q?a.features[d].geometry:(r?a.geometry:a);o=l?l.type==='GeometryCollection':!1;j=o?l.geometries.length:1;for(e=0;e<j;e++){i=o?l.geometries[e]:l;if(i===null)continue;k=i.coordinates;var u=i.type;m=c&&(u==='Polygon'||u==='MultiPolygon')?1:0;switch(u){case null:break;case 'Point':b(k,n,d,t);n++;t++;break;case 'LineString':;case 'MultiPoint':for(f=0;f<k.length;f++)b(k[f],n,d,t),n++,t++;break;case 'Polygon':;case 'MultiLineString':for(f=0;f<k.length;f++)for(g=0;g<k[f].length-m;g++)b(k[f][g],n,d,t),n++,t++;break;case 'MultiPolygon':for(f=0;f<k.length;f++)for(g=0;g<k[f].length;g++)for(h=0;h<k[f][g].length-m;h++)b(k[f][g][h],n,d,t),n++,t++;break;case 'GeometryCollection':for(f=0;f<i.geometries.length;f++)x(i.geometries[f],b,c);break;default:throw new Error('Unknown Geometry Type')}}}}function y(a,b,c,d){var e=c;x(a,function(a,d,f,g){d===0&&c===undefined?(e=a):(e=b(e,a,d,f,g))},d);return e}function z(a,b){var c;switch(a.type){case 'FeatureCollection':for(c=0;c<a.features.length;c++)b(a.features[c].properties,c);break;case 'Feature':b(a.properties,0);break}}function A(a,b,c){var d=c;z(a,function(a,e){e===0&&c===undefined?(d=a):(d=b(d,a,e))});return d}function B(a,b){if(a.type==='Feature')b(a,0);else if(a.type==='FeatureCollection'){for(var c=0;c<a.features.length;c++)b(a.features[c],c)}}function C(a,b,c){var d=c;B(a,function(a,e){e===0&&c===undefined?(d=a):(d=b(d,a,e))});return d}function D(a){var b=[];x(a,function(a){b.push(a)});return b}function E(a,b){var c,d,e,f,g,h,i,j,k=0,l=a.type==='FeatureCollection',m=a.type==='Feature',n=l?a.features.length:1;for(c=0;c<n;c++){h=l?a.features[c].geometry:(m?a.geometry:a);j=l?a.features[c].properties:(m?a.properties:{});i=h?h.type==='GeometryCollection':!1;g=i?h.geometries.length:1;for(e=0;e<g;e++){f=i?h.geometries[e]:h;if(f===null){b(null,k,j);k++;continue}switch(f.type){case 'Point':;case 'LineString':;case 'MultiPoint':;case 'Polygon':;case 'MultiLineString':;case 'MultiPolygon':{b(f,k,j);k++;break};case 'GeometryCollection':{for(d=0;d<f.geometries.length;d++)b(f.geometries[d],k,j),k++;break};default:throw new Error('Unknown Geometry Type')}}}}function F(a,b,c){var d=c;E(a,function(a,e,f){e===0&&c===undefined?(d=a):(d=b(d,a,e,f))});return d}function G(a,b){E(a,function(a,c,d){var e=a===null?null:a.type;switch(e){case null:;case 'Point':;case 'LineString':;case 'Polygon':b(K(a,d),c,0);return};var f;switch(e){case 'MultiPoint':f='Point';break;case 'MultiLineString':f='LineString';break;case 'MultiPolygon':f='Polygon';break};a.coordinates.forEach(function(a,e){var g={type:f,coordinates:a};b(K(g,d),c,e)})})}function H(a,b,c){var d=c;G(a,function(a,e,f){e===0&&f===0&&c===undefined?(d=a):(d=b(d,a,e,f))});return d}function I(a,c){G(a,function(a,b){var d=0;if(!a.geometry)return;var e=a.geometry.type;if(e==='Point'||e==='MultiPoint')return;y(a,function(e,f){var g=M([e,f],a.properties);c(g,b,d);d++;return f})})}function J(a,b,c){var d=c;I(a,function(a,e,f){e===0&&c===undefined?(d=a):(d=b(d,a,e,f))});return d}function K(a,b){if(a===undefined)throw new Error('No geometry passed');return{type:'Feature',properties:b||{},geometry:a}}function M(a,b){if(!a)throw new Error('No coordinates passed');if(a.length<2)throw new Error('Coordinates must be an array of two or more positions');return{type:'Feature',properties:b||{},geometry:{type:'LineString',coordinates:a}}}var N={coordEach:x,coordReduce:y,propEach:z,propReduce:A,featureEach:B,featureReduce:C,coordAll:D,geomEach:E,geomReduce:F,flattenEach:G,flattenReduce:H,segmentEach:I,segmentReduce:J},O=N.coordEach,P=function(a){var b=[Infinity,Infinity,-Infinity,-Infinity];O(a,function(a){b[0]>a[0]&&(b[0]=a[0]);b[1]>a[1]&&(b[1]=a[1]);b[2]<a[0]&&(b[2]=a[0]);b[3]<a[1]&&(b[3]=a[1])});return b},Q=w.point,R=function(a,b){var c=P(a),d=(c[0]+c[2])/2,e=(c[1]+c[3])/2;return Q([d,e],b)},S=0;a.SwoopyArrow=a.Layer.extend({fromLatlng:[],toLatlng:[],options:{color:'#222222',weight:1,opacity:1,factor:0.5,arrowFilled:!1,arrowId:null,minZoom:0,maxZoom:22,label:'',labelClassName:'',labelFontSize:12,labelColor:'#222222',html:'',iconAnchor:[0,0],iconSize:[50,20]},initialize:function e(b,c,d){a.Util.setOptions(this,d);this._currentPathVisible=!0;this._fromLatlng=a.latLng(b);this._toLatlng=a.latLng(c);this._factor=this.options.factor;this._label=this.options.label;this._labelFontSize=this.options.labelFontSize;this._labelColor=this.options.labelColor;this._color=this.options.color;this._labelClassName=this.options.labelClassName;this._html=this.options.html;this._opacity=this.options.opacity;this._minZoom=this.options.minZoom;this._maxZoom=this.options.maxZoom;this._iconAnchor=this.options.iconAnchor;this._iconSize=this.options.iconSize;this._weight=this.options.weight;this._arrowFilled=this.options.arrowFilled;this._arrowId=this.options.arrowId;this._initSVG()},_initSVG:function b(){this._svg=a.SVG.create('svg');this._currentId=S++;this._arrow=this._createArrow();this._svg.appendChild(this._arrow)},onAdd:function b(a){this._map=a;this.getPane().appendChild(this._svg);this._drawSwoopyArrows();this.update(this._map)},getEvents:function a(){return{zoom:this.update,viewreset:this.update}},_drawSwoopyArrows:function b(){var c=this._createPath();this._currentPath=c._path;var d=this._createLabel();this._currentMarker=a.marker([this._fromLatlng.lat,this._fromLatlng.lng],{icon:d}).addTo(this._map)},_createArrow:function b(){this._container=this._container||a.SVG.create('defs');var c=a.SVG.create('marker'),d=a.SVG.create('polyline');c.setAttribute('class','swoopyArrow__marker');c.setAttribute('id','swoopyarrow__arrowhead'+this._currentId);c.setAttribute('markerWidth','6.75');c.setAttribute('markerHeight','6.75');c.setAttribute('viewBox','-10 -10 20 20');c.setAttribute('orient','auto');c.setAttribute('refX','0');c.setAttribute('refY','0');c.setAttribute('fill','none');c.setAttribute('stroke',this._color);c.setAttribute('stroke-width',this._weight);c.setAttribute('opacity',this._opacity);d.setAttribute('stroke-linejoin','bevel');d.setAttribute('fill',this._arrowFilled?this._color:'none');d.setAttribute('stroke',this._color);d.setAttribute('points','-6.75,-6.75 0,0 -6.75,6.75');c.appendChild(d);this._container.appendChild(c);return this._container},_createPath:function b(){var c=this._getControlPoint(a.latLng(this._fromLatlng),a.latLng(this._toLatlng),this.options.factor),d=a.curve(['M',[this._fromLatlng.lat,this._fromLatlng.lng],'Q',[c.lat,c.lng],[this._toLatlng.lat,this._toLatlng.lng]],{animate:!1,color:this._color,fill:!1,opacity:this._opacity,weight:this._weight,className:'swoopyarrow__path'}).addTo(this._map);d._path.setAttribute('id','swoopyarrow__path'+this._currentId);d._path.setAttribute('marker-end',!this._arrowId?'url(#swoopyarrow__arrowhead'+this._currentId+')':'url('+this._arrowId+')');return d},_rotatePoint:function d(a,b,c){var e=c*Math.PI/180.0;return{x:Math.cos(e)*(b.x-a.x)-Math.sin(e)*(b.y-a.y)+a.x,y:Math.sin(e)*(b.x-a.x)+Math.cos(e)*(b.y-a.y)+a.y}},_getControlPoint:function e(b,c,d){var f=w.featureCollection([w.point([b.lat,b.lng]),w.point([c.lat,c.lng])]),g=R(f),h=this._map.latLngToContainerPoint(b),i=this._map.latLngToContainerPoint(a.latLng(g.geometry.coordinates[0],g.geometry.coordinates[1])),j=this._rotatePoint(i,h,90),k=Math.sqrt(Math.pow(h.x-i.x,2)+Math.pow(h.y-i.y,2)),l=Math.atan2(j.y-i.y,j.x-i.x),m=d*k-k,n=Math.sin(l)*m,o=Math.cos(l)*m,p=a.point(j.x+o,j.y+n);return this._map.containerPointToLatLng(p)},_createLabel:function b(){return a.divIcon({className:this._html===''&&this._labelClassName,html:this._html===''?'<span id="marker-label'+this._currentId+'" style="font-size: '+this._labelFontSize+'px; color: '+this._labelColor+'">'+this._label+'</span>':this._html,iconAnchor:this._iconAnchor,iconSize:this._iconSize})},update:function b(a){this._checkZoomLevel();var c=this._svg.getElementById('swoopyarrow__arrowhead'+this._currentId);c.setAttribute('markerWidth',''+2.5*this._map.getZoom());c.setAttribute('markerHeight',''+2.5*this._map.getZoom());return this},_checkZoomLevel:function a(){var b=this._map.getZoom();this._currentPathVisible||(this._currentPath.setAttribute('opacity',this._opacity),this._currentMarker.setOpacity(this._opacity));(b<this._minZoom||b>this._maxZoom)&&(this._currentPath.setAttribute('opacity',0),this._currentMarker.setOpacity(0),this._currentPathVisible=!1)},onRemove:function b(a){this._map=a;this._currentPath.parentNode.removeChild(this._currentPath);this._map.removeLayer(this._currentMarker)}});a.swoopyArrow=function(b,c,d){return new a.SwoopyArrow(b,c,d)}}))
//# sourceMappingURL=Leaflet.SwoopyArrow.min.js.map
